<script lang="ts">
	import { login, register } from '$lib/remote/players.remote';

	// svelte-ignore non_reactive_update
	let loginForm: HTMLFormElement;
	// svelte-ignore non_reactive_update
	let registerForm: HTMLFormElement;
	// svelte-ignore non_reactive_update
	let password: HTMLInputElement;
	// svelte-ignore non_reactive_update
	let confirmPassword: HTMLInputElement;

	let error = '';
	let loading = $state(false);

	let pageState: 'start' | 'login' | 'register' = $state('start');

	function validateConfirmPassword() {
		if (!password) {
			confirmPassword.setCustomValidity('');
			return;
		}

		if (password.value != confirmPassword.value) {
			confirmPassword.setCustomValidity("Passwords Don't Match");
		} else {
			confirmPassword.setCustomValidity('');
		}

		if (password.value.length < 8) {
			password.setCustomValidity('Password must be at least 8 characters');
		}
	}
</script>

<div class="flex h-full flex-col items-center gap-4 p-4">
	{#if pageState === 'start'}
		<div class="flex h-full items-center justify-center">
			<!-- <img src="/f1.png" alt="Logo" class="size-90" /> -->
			<svg
				version="1.1"
				id="Layer_1"
				xmlns="http://www.w3.org/2000/svg"
				xmlns:xlink="http://www.w3.org/1999/xlink"
				x="0px"
				y="0px"
				width="100%"
				viewBox="0 0 512 512"
				enable-background="new 0 0 512 512"
				xml:space="preserve"
			>
				<path
					fill="#000000"
					opacity="0.000000"
					stroke="none"
					d="
M1.000000,222.000000 
	C1.000000,148.364761 1.000000,74.729515 1.000000,1.047138 
	C171.562424,1.047138 342.124878,1.047138 513.000000,1.047138 
	C513.000000,95.688454 513.000000,190.377243 512.614441,285.484039 
	C509.520874,285.269104 506.821228,284.135468 504.103394,284.090088 
	C492.498535,283.896332 480.888336,284.023987 469.052673,283.717896 
	C465.313904,282.165558 461.826935,280.854401 458.286621,279.707977 
	C447.215546,276.122864 436.124329,272.599976 424.970886,268.695862 
	C415.071411,242.836136 383.946747,233.784332 361.934326,247.668488 
	C359.373413,245.973251 356.671661,244.944275 354.741272,243.105499 
	C347.753235,236.449020 341.072968,229.470901 334.181427,222.711136 
	C329.059967,217.687607 322.799561,214.269699 315.653870,215.156311 
	C302.717590,216.761414 289.867645,219.147797 277.041626,221.530807 
	C264.871216,223.792023 252.791016,226.536545 240.631287,228.859940 
	C239.300995,229.114151 236.997787,228.389053 236.440079,227.393280 
	C235.904953,226.437851 236.630814,224.128021 237.571442,223.162506 
	C238.681931,222.022644 240.662582,221.005768 242.188950,221.106201 
	C260.383118,222.303467 256.631195,216.634750 256.970581,204.766556 
	C257.073303,201.174438 254.867889,199.419312 251.496017,199.025925 
	C250.015152,198.853134 248.507721,198.907898 246.830566,198.589020 
	C239.749496,188.508453 230.622833,183.850327 218.463776,185.964966 
	C216.687317,186.273926 214.811234,186.024719 212.981476,186.009369 
	C209.978546,185.984192 206.900162,186.276886 206.789154,190.102310 
	C206.668076,194.274414 210.043152,194.193054 212.874603,193.943695 
	C217.553467,193.531677 221.441086,194.531189 223.491516,198.905884 
	C213.225143,198.979950 203.418320,198.861511 193.616425,199.030014 
	C180.254272,199.259720 167.981628,203.340027 156.486618,210.010895 
	C148.343048,214.736801 140.412109,219.935837 131.916306,223.922073 
	C120.291595,229.376434 107.701035,230.492462 94.929626,230.050629 
	C88.738091,229.836456 86.025833,232.822586 85.991852,239.004364 
	C85.979080,241.327881 85.891174,243.650986 85.481522,245.912460 
	C78.461212,244.224182 71.796913,242.597717 65.078995,240.507874 
	C65.017220,235.718765 65.030090,231.392853 64.995499,227.067337 
	C64.953537,221.821655 63.140949,220.014496 57.828388,220.006332 
	C43.686375,219.984589 29.541277,219.832947 15.403929,220.090668 
	C10.592616,220.178360 5.800751,221.332932 1.000000,222.000000 
z"
				/>
				<path
					fill="#000000"
					opacity="0.000000"
					stroke="none"
					d="
M513.000000,304.000000 
	C513.000000,373.634003 513.000000,443.267975 513.000000,512.950989 
	C342.446045,512.950989 171.892090,512.950989 1.000000,512.950989 
	C1.000000,443.645599 1.000000,374.290649 1.385513,304.517334 
	C8.486610,304.731720 15.196611,305.753632 21.919889,305.850098 
	C25.907850,305.907318 28.380266,307.308716 30.631937,310.335236 
	C44.187195,328.555359 70.043121,332.881287 88.982422,320.556763 
	C92.094116,318.531830 96.266579,317.152679 99.953621,317.142029 
	C168.897430,316.942657 237.843613,316.759735 306.784637,317.239929 
	C317.608826,317.315308 324.839386,314.770416 328.415192,304.040588 
	C333.836823,302.308105 338.874176,300.603546 344.156677,299.155884 
	C351.097595,317.504028 369.703827,329.363434 390.005737,327.124329 
	C408.368713,325.099060 423.648132,311.490448 427.404480,293.108490 
	C434.825378,294.821503 441.884003,296.377167 448.957825,298.341431 
	C449.423920,304.310089 451.216919,305.947510 457.383636,305.974396 
	C471.373260,306.035400 485.366211,306.156128 499.351593,305.905182 
	C503.910980,305.823364 508.451080,304.665649 513.000000,304.000000 
z"
				/>
				<path
					opacity="1.000000"
					stroke="none"
					d="
M328.030914,304.068512 
	C324.839386,314.770416 317.608826,317.315308 306.784637,317.239929 
	C237.843613,316.759735 168.897430,316.942657 99.953621,317.142029 
	C96.266579,317.152679 92.094116,318.531830 88.982422,320.556763 
	C70.043121,332.881287 44.187195,328.555359 30.631937,310.335236 
	C28.380266,307.308716 25.907850,305.907318 21.919889,305.850098 
	C15.196611,305.753632 8.486610,304.731720 1.385513,304.049500 
	C1.000000,298.311951 1.000000,292.623932 1.385831,286.419739 
	C4.989354,285.270081 8.194118,284.181122 11.427187,284.089386 
	C20.685820,283.826569 20.690334,283.985596 23.196514,274.658020 
	C28.714851,256.972504 39.961807,245.980652 57.993450,242.345596 
	C60.368980,241.866699 62.752693,241.428375 65.132614,240.971252 
	C71.796913,242.597717 78.461212,244.224182 85.601555,246.241180 
	C95.016037,253.323883 102.565216,261.059265 106.055489,272.091919 
	C106.344437,273.005219 108.701950,273.714417 110.115677,273.746155 
	C117.444321,273.910583 124.786240,274.037689 132.109161,273.776001 
	C143.753571,273.359955 153.569992,277.139252 161.972626,285.239716 
	C168.857010,291.876526 177.330292,295.027954 186.921509,295.048004 
	C195.753525,295.066498 204.589722,294.894287 213.416885,295.105988 
	C251.359619,296.015930 288.512146,291.463989 324.746216,279.809967 
	C327.250488,279.004456 331.150635,279.812012 333.326599,281.370422 
	C336.366577,283.547729 335.515808,287.235107 333.994141,290.502747 
	C331.909424,294.979492 330.009857,299.542480 328.030914,304.068512 
M67.285347,318.015961 
	C88.203148,315.913666 101.839958,297.989532 97.997284,277.648376 
	C94.424751,258.737244 74.650940,246.737137 55.764942,252.018906 
	C40.185081,256.376068 29.422232,272.219177 31.470911,287.780121 
	C33.895054,306.192963 47.528954,318.014801 67.285347,318.015961 
z"
				/>
				<path
					opacity="1.000000"
					class="fill-accent"
					stroke="none"
					d="
M65.078995,240.507874 
	C62.752693,241.428375 60.368980,241.866699 57.993450,242.345596 
	C39.961807,245.980652 28.714851,256.972504 22.847801,274.566040 
	C15.235970,271.203979 8.117987,267.601990 1.000002,264.000000 
	C1.000000,250.312439 1.000000,236.624878 1.000000,222.468658 
	C5.800751,221.332932 10.592616,220.178360 15.403929,220.090668 
	C29.541277,219.832947 43.686375,219.984589 57.828388,220.006332 
	C63.140949,220.014496 64.953537,221.821655 64.995499,227.067337 
	C65.030090,231.392853 65.017220,235.718765 65.078995,240.507874 
z"
				/>
				<path
					opacity="1.000000"
					stroke="none"
					d="
M513.000000,303.532043 
	C508.451080,304.665649 503.910980,305.823364 499.351593,305.905182 
	C485.366211,306.156128 471.373260,306.035400 457.383636,305.974396 
	C451.216919,305.947510 449.423920,304.310089 448.978821,297.901001 
	C448.988983,296.224731 448.993042,295.397461 448.997986,294.570221 
	C449.046082,286.474060 451.105316,284.485138 459.388336,284.383942 
	C462.686493,284.343689 465.982880,284.155334 469.280060,284.034424 
	C480.888336,284.023987 492.498535,283.896332 504.103394,284.090088 
	C506.821228,284.135468 509.520874,285.269104 512.614441,285.951019 
	C513.000000,291.688049 513.000000,297.376068 513.000000,303.532043 
z"
				/>
				<path
					fill="#000000"
					opacity="0.000000"
					stroke="none"
					d="
M1.000002,264.468567 
	C8.117987,267.601990 15.235970,271.203979 22.702667,274.897949 
	C20.690334,283.985596 20.685820,283.826569 11.427187,284.089386 
	C8.194118,284.181122 4.989354,285.270081 1.385831,285.951813 
	C1.000000,278.979034 1.000000,271.958099 1.000002,264.468567 
z"
				/>
				<path
					class="fill-accent"
					opacity="1.000000"
					stroke="none"
					d="
M328.415192,304.040588 
	C330.009857,299.542480 331.909424,294.979492 333.994141,290.502747 
	C335.515808,287.235107 336.366577,283.547729 333.326599,281.370422 
	C331.150635,279.812012 327.250488,279.004456 324.746216,279.809967 
	C288.512146,291.463989 251.359619,296.015930 213.416885,295.105988 
	C204.589722,294.894287 195.753525,295.066498 186.921509,295.048004 
	C177.330292,295.027954 168.857010,291.876526 161.972626,285.239716 
	C153.569992,277.139252 143.753571,273.359955 132.109161,273.776001 
	C124.786240,274.037689 117.444321,273.910583 110.115677,273.746155 
	C108.701950,273.714417 106.344437,273.005219 106.055489,272.091919 
	C102.565216,261.059265 95.016037,253.323883 85.957565,246.303009 
	C85.891174,243.650986 85.979080,241.327881 85.991852,239.004364 
	C86.025833,232.822586 88.738091,229.836456 94.929626,230.050629 
	C107.701035,230.492462 120.291595,229.376434 131.916306,223.922073 
	C140.412109,219.935837 148.343048,214.736801 156.486618,210.010895 
	C167.981628,203.340027 180.254272,199.259720 193.616425,199.030014 
	C203.418320,198.861511 213.225143,198.979950 223.958389,198.973892 
	C232.262131,198.937958 239.637238,198.898651 247.012360,198.859344 
	C248.507721,198.907898 250.015152,198.853134 251.496017,199.025925 
	C254.867889,199.419312 257.073303,201.174438 256.970581,204.766556 
	C256.631195,216.634750 260.383118,222.303467 242.188950,221.106201 
	C240.662582,221.005768 238.681931,222.022644 237.571442,223.162506 
	C236.630814,224.128021 235.904953,226.437851 236.440079,227.393280 
	C236.997787,228.389053 239.300995,229.114151 240.631287,228.859940 
	C252.791016,226.536545 264.871216,223.792023 277.041626,221.530807 
	C289.867645,219.147797 302.717590,216.761414 315.653870,215.156311 
	C322.799561,214.269699 329.059967,217.687607 334.181427,222.711136 
	C341.072968,229.470901 347.753235,236.449020 354.741272,243.105499 
	C356.671661,244.944275 359.373413,245.973251 361.749420,247.957108 
	C349.906799,256.848511 343.050873,268.136475 342.450989,282.679443 
	C342.229156,288.056702 343.384338,293.490814 343.911530,298.898987 
	C338.874176,300.603546 333.836823,302.308105 328.415192,304.040588 
M290.025757,234.540527 
	C280.362701,236.459854 270.699615,238.379166 259.752380,240.553558 
	C283.895172,240.553558 306.639374,240.553558 330.965485,240.553558 
	C328.776581,238.831543 327.554260,238.153519 326.706940,237.156738 
	C321.721375,231.291702 316.028778,228.441376 308.018616,230.870193 
	C302.456726,232.556625 296.538452,233.067795 290.025757,234.540527 
z"
				/>
				<!--right Tyre-->
				<path
					opacity="1.000000"
					stroke="none"
					d="
M344.156677,299.155884 
	C343.384338,293.490814 342.229156,288.056702 342.450989,282.679443 
	C343.050873,268.136475 349.906799,256.848511 361.962524,248.251785 
	C383.946747,233.784332 415.071411,242.836136 425.000977,269.083313 
	C425.748138,277.535645 426.395172,285.243378 427.042206,292.951111 
	C423.648132,311.490448 408.368713,325.099060 390.005737,327.124329 
	C369.703827,329.363434 351.097595,317.504028 344.156677,299.155884 
M352.017670,291.338989 
	C352.412933,292.778442 352.723053,294.247772 353.216461,295.652740 
	C358.778290,311.491364 375.595734,320.941589 391.799652,317.361511 
	C408.482269,313.675629 420.212189,298.280884 418.653320,282.117798 
	C416.728973,262.165344 400.010162,248.630081 380.280731,251.051971 
	C361.630310,253.341400 348.872650,271.082214 352.017670,291.338989 
z"
				/>
				<!--front wing-->
				<path
					class="fill-accent"
					opacity="1.000000"
					stroke="none"
					d="
M427.404480,293.108490 
	C426.395172,285.243378 425.748138,277.535645 425.071014,269.440430 
	C436.124329,272.599976 447.215546,276.122864 458.286621,279.707977 
	C461.826935,280.854401 465.313904,282.165558 469.052673,283.717896 
	C465.982880,284.155334 462.686493,284.343689 459.388336,284.383942 
	C451.105316,284.485138 449.046082,286.474060 448.997986,294.570221 
	C448.993042,295.397461 448.988983,296.224731 448.963562,297.492401 
	C441.884003,296.377167 434.825378,294.821503 427.404480,293.108490 
z"
				/>
				<!--top fin-->
				<path
					opacity="1.000000"
					stroke="none"
					d="
M246.830566,198.589020 
	C239.637238,198.898651 232.262131,198.937958 224.420135,198.909271 
	C221.441086,194.531189 217.553467,193.531677 212.874603,193.943695 
	C210.043152,194.193054 206.668076,194.274414 206.789154,190.102310 
	C206.900162,186.276886 209.978546,185.984192 212.981476,186.009369 
	C214.811234,186.024719 216.687317,186.273926 218.463776,185.964966 
	C230.622833,183.850327 239.749496,188.508453 246.830566,198.589020 
z"
				/>
				<!--left wheel outer-->
				<path
					class="fill-accent"
					opacity="1.000000"
					stroke="none"
					d="
M66.827911,318.028595 
	C47.528954,318.014801 33.895054,306.192963 31.470911,287.780121 
	C29.422232,272.219177 40.185081,256.376068 55.764942,252.018906 
	C74.650940,246.737137 94.424751,258.737244 97.997284,277.648376 
	C101.839958,297.989532 88.203148,315.913666 66.827911,318.028595 
M83.171532,303.690521 
	C92.142799,294.133240 94.022537,282.107025 88.186607,271.605133 
	C82.543816,261.450836 70.877785,256.033234 59.820744,258.432251 
	C49.014286,260.776886 40.646652,269.234680 38.986053,279.491455 
	C37.115978,291.042084 41.838699,301.463837 51.557121,307.232422 
	C61.525867,313.149597 72.809799,312.041016 83.171532,303.690521 
z"
				/>
				<!--bg-->
				<path
					fill="#000000"
					opacity="0.000000"
					stroke="none"
					d="
M290.402588,234.322296 
	C296.538452,233.067795 302.456726,232.556625 308.018616,230.870193 
	C316.028778,228.441376 321.721375,231.291702 326.706940,237.156738 
	C327.554260,238.153519 328.776581,238.831543 330.965485,240.553558 
	C306.639374,240.553558 283.895172,240.553558 259.752380,240.553558 
	C270.699615,238.379166 280.362701,236.459854 290.402588,234.322296 
z"
				/>
				<!--Right Wheel Outer-->
				<path
					class="fill-accent"
					opacity="1.000000"
					stroke="none"
					d="
M351.964050,290.921326 
	C348.872650,271.082214 361.630310,253.341400 380.280731,251.051971 
	C400.010162,248.630081 416.728973,262.165344 418.653320,282.117798 
	C420.212189,298.280884 408.482269,313.675629 391.799652,317.361511 
	C375.595734,320.941589 358.778290,311.491364 353.216461,295.652740 
	C352.723053,294.247772 352.412933,292.778442 351.964050,290.921326 
M404.196930,302.677002 
	C412.509003,292.768829 413.830078,280.878082 407.741333,270.774414 
	C401.973694,261.203583 390.530548,256.128998 379.873596,258.416138 
	C368.639435,260.827148 360.350464,269.514984 358.870270,280.430176 
	C357.317444,291.880920 362.480530,302.344635 372.346649,307.741974 
	C382.584198,313.342499 394.205719,311.652527 404.196930,302.677002 
z"
				/>
				<!--left wheel inner-->
				<path
					fill="#636361"
					opacity="1.000000"
					stroke="none"
					d="
M82.907928,303.934387 
	C72.809799,312.041016 61.525867,313.149597 51.557121,307.232422 
	C41.838699,301.463837 37.115978,291.042084 38.986053,279.491455 
	C40.646652,269.234680 49.014286,260.776886 59.820744,258.432251 
	C70.877785,256.033234 82.543816,261.450836 88.186607,271.605133 
	C94.022537,282.107025 92.142799,294.133240 82.907928,303.934387 
M73.054413,277.461090 
	C68.432945,273.492157 63.613888,272.638458 59.477604,275.336304 
	C55.518661,277.918457 53.632427,281.633087 54.566200,286.415283 
	C55.449242,290.937683 58.289227,293.849304 62.725773,294.827789 
	C66.944328,295.758179 70.722939,294.496735 73.363235,290.992645 
	C76.514961,286.809784 76.457970,282.402649 73.054413,277.461090 
z"
				/>
				<!--right wheel inner-->
				<path
					fill="#636361"
					opacity="1.000000"
					stroke="none"
					d="
M403.943542,302.930511 
	C394.205719,311.652527 382.584198,313.342499 372.346649,307.741974 
	C362.480530,302.344635 357.317444,291.880920 358.870270,280.430176 
	C360.350464,269.514984 368.639435,260.827148 379.873596,258.416138 
	C390.530548,256.128998 401.973694,261.203583 407.741333,270.774414 
	C413.830078,280.878082 412.509003,292.768829 403.943542,302.930511 
M375.309052,288.966187 
	C380.503754,296.609192 389.706665,297.141235 394.039490,290.049072 
	C396.593384,285.868622 396.089569,280.718842 392.779083,277.166473 
	C389.538574,273.689087 384.177734,272.792786 379.982849,275.026978 
	C375.291260,277.525665 373.598419,282.050629 375.309052,288.966187 
z"
				/>
				<!--left wheel nut-->
				<path
					fill="#FBFBFB"
					opacity="1.000000"
					stroke="none"
					d="
M73.301544,277.752075 
	C76.457970,282.402649 76.514961,286.809784 73.363235,290.992645 
	C70.722939,294.496735 66.944328,295.758179 62.725773,294.827789 
	C58.289227,293.849304 55.449242,290.937683 54.566200,286.415283 
	C53.632427,281.633087 55.518661,277.918457 59.477604,275.336304 
	C63.613888,272.638458 68.432945,273.492157 73.301544,277.752075 
z"
				/>
				<!--right wheel nut-->
				<path
					fill="#FBFBFB"
					opacity="1.000000"
					stroke="none"
					d="
M375.172424,288.608215 
	C373.598419,282.050629 375.291260,277.525665 379.982849,275.026978 
	C384.177734,272.792786 389.538574,273.689087 392.779083,277.166473 
	C396.089569,280.718842 396.593384,285.868622 394.039490,290.049072 
	C389.706665,297.141235 380.503754,296.609192 375.172424,288.608215 
z"
				/>
			</svg>

			<!-- <img src="/logo.png" alt="Logo" class="size-90" /> -->
		</div>

		<div class="flex w-full flex-col justify-end gap-4 lg:max-w-96">
			<button class="btn btn-lg btn-primary" onclick={() => (pageState = 'login')}>Login</button>
			<button class="btn btn-lg btn-secondary" onclick={() => (pageState = 'register')}
				>Register</button
			>
		</div>
	{:else if pageState === 'login'}
		<div class="flex h-16 w-full items-center justify-start gap-4 p-4">
			<svg
				xmlns="http://www.w3.org/2000/svg"
				fill="none"
				viewBox="0 0 24 24"
				stroke-width="1.5"
				stroke="currentColor"
				class="size-6 cursor-pointer"
				onclick={() => (pageState = 'start')}
			>
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"
				/>
			</svg>
		</div>

		{#if error}
			<div class="mt-2 alert alert-error">
				<span>{error}</span>
			</div>
		{/if}

		<form
			{...login}
			id="login-form"
			class="flex h-full w-full flex-col items-center justify-center gap-4"
			bind:this={loginForm}
			method="post"
		>
			<div class="text-center text-3xl">Sign In</div>
			<input name="email" class="input input-lg" type="email" required placeholder="Email" />

			<input
				name="password"
				type="password"
				class="input input-lg"
				required
				placeholder="Password"
				onkeypress={(e) => {
					if (e.key !== 'Enter') return;
					loading = true;
					loginForm.submit();
				}}
			/>
		</form>
		<div class="flex h-16 w-full flex-col gap-4 lg:max-w-96">
			<button
				onclick={() => {
					loading = true;
					loginForm.submit();
				}}
				class="btn w-full btn-lg btn-primary lg:max-w-96"
				type="button"
				disabled={loading}
			>
				{loading ? 'Logging in...' : 'Login'}
			</button>
		</div>
	{:else if pageState === 'register'}
		<div class="flex h-16 w-full items-center justify-start gap-4 p-4">
			<svg
				xmlns="http://www.w3.org/2000/svg"
				fill="none"
				viewBox="0 0 24 24"
				stroke-width="1.5"
				stroke="currentColor"
				class="size-6 cursor-pointer"
				onclick={() => (pageState = 'start')}
			>
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"
				/>
			</svg>
		</div>
		<form
			{...register}
			id="register-form"
			bind:this={registerForm}
			class="flex h-full w-full flex-col items-center justify-center gap-4"
			method="post"
		>
			<div class="text-center text-3xl">Sign Up</div>

			<input name="name" class="input input-lg" type="text" required placeholder="Username" />

			<input name="email" class="input input-lg" type="email" required placeholder="Email" />

			<input
				name="password"
				type="password"
				class="input input-lg"
				required
				placeholder="Password"
				bind:this={password}
			/>

			<input
				name="passwordConfirm"
				type="password"
				class="input input-lg"
				required
				placeholder="Confirm Password"
				bind:this={confirmPassword}
				onchange={validateConfirmPassword}
				onkeyup={validateConfirmPassword}
			/>
		</form>
		<button
			form="register-form"
			onclick={() => {
				loading = true;
				registerForm.submit();
			}}
			class="btn w-full btn-lg btn-primary lg:max-w-96"
			type="submit"
			disabled={loading}
		>
			{loading ? 'Registering...' : 'Register'}
		</button>
	{/if}
</div>
